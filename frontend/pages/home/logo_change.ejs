<!DOCTYPE html>
<html lang="en">
<%- include('../../header', { title: 'Express with EJS' }) %>
  <style>
    .table td img,
    .jsgrid .jsgrid-table td img {
      width: 100px !important;
      height: 100px !important;
      border-radius: 0;
    }

    .logo_page {
      display: flex;
      justify-content: center;
    }
   .button_color {
      background-color: #4b49ac;
    }
 
  </style>

  <body>
    <div class="container-scroller">
      <%- include('../../navbar') %>
        <div class="container-fluid page-body-wrapper">
          <%- include('../../sidebar') %>
            <div class="main-panel">
              <div class="content-wrapper">
                <div class="row">
                  <div class="col-md-12 grid-margin stretch-card">
                    <div class="card">
                      <div class="card-body">
                        <div class="row logo_page">
                          <form id="uploadLogoForm" class="pt-3" method="post" enctype="multipart/form-data"
                            onsubmit="event.preventDefault(); validateAndUpload();">
                            <div class="form-group">
                              <input type="file" class="form-control form-control-lg" id="logo" accept="image/*"
                                onchange="clearError('fileError')" required />
                              <p id="fileError" style="color: red"></p>
                            </div>
                            <div id="uploadSuccessMsg" style="color: green"></div>
                            <div id="upload_error" style="color: red"></div>
                            <div class="mt-3">
                              <button type="submit"
                                class="button_color btn btn-block btn-primary font-weight-medium auth-form-btn">
                                UPLOAD LOGO
                              </button>
                            </div>
                          </form>

                          <script>
                            function clearError(errorId) {
                              document.getElementById(errorId).innerText = "";
                            }

                            function validateAndUpload() {
                              const logoInput = document.getElementById("logo");
                              const fileError =
                                document.getElementById("fileError");
                              const uploadSuccessMsg =
                                document.getElementById("uploadSuccessMsg");
                              const uploadError =
                                document.getElementById("upload_error");

                              if (!logoInput.files.length) {
                                fileError.innerText = "Please select a file.";
                                return;
                              }

                              const formData = new FormData();
                              formData.append("logo", logoInput.files[0]);

                              fetch("/api/upload-logo", {
                                method: "POST",
                                body: formData,
                              })
                                .then((response) => response.json())
                                .then((data) => {
                                  if (data.success) {
                                    uploadSuccessMsg.innerText =
                                      "Logo uploaded successfully!";
                                    uploadError.innerText = "";

                                    setTimeout(() => {
                                      uploadSuccessMsg.innerHTML = "";
                                    }, 2000);
                                  } else {
                                    uploadError.innerText =
                                      "Failed to upload logo.";
                                    uploadSuccessMsg.innerText = "";

                                    setTimeout(() => {
                                      uploadSuccessMsg.innerHTML = "";
                                    }, 2000);
                                  }
                                })
                                .catch((error) => {
                                  uploadError.innerText = "Error uploading logo.";
                                  uploadSuccessMsg.innerText = "";
                                });
                            }
                          </script>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <%- include('../../footer') %>
            </div>
        </div>
    </div>
    <%- include('../../foot') %>
  </body>

</html>